# ============================================================================
# Quantum Trader v3.0 - Docker Compose Production Overrides
# ============================================================================
# 
# Usage:
#   docker-compose -f docker-compose.yml -f docker-compose.prod.yml up -d
# 
# Production Changes:
#   - Higher resource limits
#   - Optimized restart policies
#   - Production logging
#   - No development volumes
#   - Stricter health checks
# 
# ============================================================================

version: '3.8'

services:
  
  redis:
    deploy:
      resources:
        limits:
          cpus: '2.0'
          memory: 4G
        reservations:
          cpus: '1.0'
          memory: 2G
      replicas: 1
      restart_policy:
        condition: on-failure
        delay: 5s
        max_attempts: 3
        window: 120s
  
  postgres:
    deploy:
      resources:
        limits:
          cpus: '4.0'
          memory: 8G
        reservations:
          cpus: '2.0'
          memory: 4G
      replicas: 1
      restart_policy:
        condition: on-failure
        delay: 10s
        max_attempts: 3
        window: 120s
  
  ai-service:
    environment:
      - LOG_LEVEL=WARNING
      - MIN_CONFIDENCE_THRESHOLD=0.7
      - SIGNAL_GENERATION_INTERVAL_SECONDS=30
    deploy:
      resources:
        limits:
          cpus: '8.0'
          memory: 16G
        reservations:
          cpus: '4.0'
          memory: 8G
      replicas: 1
      restart_policy:
        condition: on-failure
        delay: 15s
        max_attempts: 5
        window: 180s
  
  exec-risk-service:
    environment:
      - LOG_LEVEL=WARNING
      - BINANCE_TESTNET=false
      - MAX_LEVERAGE=10.0
      - MAX_POSITION_SIZE_USD=5000.0
      - MAX_PORTFOLIO_EXPOSURE_USD=25000.0
    deploy:
      resources:
        limits:
          cpus: '4.0'
          memory: 8G
        reservations:
          cpus: '2.0'
          memory: 4G
      replicas: 1
      restart_policy:
        condition: on-failure
        delay: 15s
        max_attempts: 5
        window: 180s
  
  analytics-os-service:
    environment:
      - LOG_LEVEL=WARNING
      - AUTO_RESTART_ENABLED=true
      - HEALTH_CHECK_INTERVAL_SECONDS=5
    deploy:
      resources:
        limits:
          cpus: '4.0'
          memory: 8G
        reservations:
          cpus: '2.0'
          memory: 4G
      replicas: 1
      restart_policy:
        condition: on-failure
        delay: 15s
        max_attempts: 5
        window: 180s
  
  prometheus:
    command:
      - '--config.file=/etc/prometheus/prometheus.yml'
      - '--storage.tsdb.path=/prometheus'
      - '--storage.tsdb.retention.time=90d'
      - '--web.enable-lifecycle'
    deploy:
      resources:
        limits:
          cpus: '2.0'
          memory: 4G
        reservations:
          cpus: '1.0'
          memory: 2G
  
  grafana:
    environment:
      - GF_SECURITY_ADMIN_PASSWORD=${GRAFANA_ADMIN_PASSWORD}
      - GF_ANALYTICS_REPORTING_ENABLED=false
      - GF_ANALYTICS_CHECK_FOR_UPDATES=false
