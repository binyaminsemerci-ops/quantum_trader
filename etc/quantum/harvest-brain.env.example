#!/bin/bash
# HarvestBrain Configuration (Template)
# Location: /etc/quantum/harvest-brain.env
# Copy to /etc/quantum/harvest-brain.env and adjust as needed

# ============================================================================
# OPERATION MODE
# ============================================================================
# HARVEST_MODE=shadow    : Proposals only (dry run, no live intents)
# HARVEST_MODE=live      : Publish reduce-only intents to trade.intent
HARVEST_MODE=shadow

# ============================================================================
# REDIS CONNECTION
# ============================================================================
REDIS_HOST=127.0.0.1
REDIS_PORT=6379

# ============================================================================
# STREAM NAMES
# ============================================================================
# Input streams
STREAM_EXECUTION_RESULT=quantum:stream:execution.result
STREAM_POSITION_SNAPSHOT=quantum:stream:position.snapshot
STREAM_PNL_SNAPSHOT=quantum:stream:pnl.snapshot

# Output streams
STREAM_TRADE_INTENT=quantum:stream:trade.intent
STREAM_HARVEST_SUGGESTIONS=quantum:stream:harvest.suggestions

# ============================================================================
# HARVEST POLICY
# ============================================================================

# Minimum R to trigger harvesting
HARVEST_MIN_R=0.5

# R-based ladder: "R_level:fraction_to_close,R_level:fraction_to_close,..."
# Example: At R=0.5 close 25%, at R=1.0 close 25%, at R=1.5 close 25%
HARVEST_LADDER=0.5:0.25,1.0:0.25,1.5:0.25

# R level at which to move stop loss to break-even
HARVEST_SET_BE_AT_R=0.5

# Trailing stop: ATR multiplier
HARVEST_TRAIL_ATR_MULT=2.0

# ============================================================================
# SAFETY & RELIABILITY
# ============================================================================

# Dedup time-to-live (seconds) - prevents duplicate harvesting actions
HARVEST_DEDUP_TTL_SEC=900

# Require fresh position snapshot (seconds old)
# Skip harvesting if position data is older than this
HARVEST_REQUIRE_FRESH_SNAPSHOT_SEC=30

# Always use reduce_only=true for harvesting intents
HARVEST_REDUCE_ONLY=true

# Maximum harvesting actions per minute (rate limiting)
HARVEST_MAX_ACTIONS_PER_MIN=30

# Kill-switch key: set to 1 to disable all harvesting
HARVEST_KILL_SWITCH_KEY=quantum:kill

# ============================================================================
# LOGGING
# ============================================================================
LOG_LEVEL=INFO
LOG_FILE=/var/log/quantum/harvest_brain.log
