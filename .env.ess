# ============================================================================
# EMERGENCY STOP SYSTEM (ESS) - Configuration
# ============================================================================
# This file contains all ESS-specific environment variables.
# Copy these to your .env file and adjust thresholds for your risk tolerance.

# === ESS: Core Settings ===
QT_ESS_ENABLED=true                          # Enable/disable ESS (default: true)
QT_ESS_CHECK_INTERVAL=5                      # Seconds between condition checks (default: 5)

# === ESS: Drawdown Thresholds ===
QT_ESS_MAX_DAILY_LOSS=8.0                    # Max daily loss % before emergency stop (default: 8%)
QT_ESS_MAX_EQUITY_DD=12.0                    # Max equity drawdown % before emergency stop (default: 12%)

# === ESS: System Health Thresholds ===
QT_ESS_HEALTH_CRITICAL_TRIGGER=true          # Trigger ESS if SystemHealthMonitor reports CRITICAL (default: true)

# === ESS: Execution Error Thresholds ===
QT_ESS_MAX_SL_HITS=4                         # Max stop-loss hits in window before emergency stop (default: 4)
QT_ESS_ERROR_WINDOW_MINUTES=30               # Time window for counting errors (default: 30 minutes)

# === ESS: Data Feed Thresholds ===
QT_ESS_MAX_STALE_SECONDS=300                 # Max seconds without data update before emergency stop (default: 300 = 5 minutes)
QT_ESS_CORRUPT_DATA_TRIGGER=true             # Trigger ESS on corrupted data detection (default: true)

# === ESS: Alert Configuration ===
# Slack Alerts
QT_ESS_SLACK_ENABLED=false                   # Enable Slack notifications (default: false)
QT_ESS_SLACK_WEBHOOK_URL=https://hooks.slack.com/services/YOUR/WEBHOOK/URL
QT_ESS_SLACK_CHANNEL=#trading-alerts
QT_ESS_SLACK_USERNAME=ESS Bot
QT_ESS_SLACK_ICON_EMOJI=:rotating_light:

# SMS Alerts (Twilio)
QT_ESS_SMS_ENABLED=false                     # Enable SMS notifications (default: false)
QT_ESS_TWILIO_ACCOUNT_SID=YOUR_TWILIO_ACCOUNT_SID
QT_ESS_TWILIO_AUTH_TOKEN=YOUR_TWILIO_AUTH_TOKEN
QT_ESS_TWILIO_FROM_NUMBER=+1234567890
QT_ESS_TWILIO_TO_NUMBERS=+1234567890,+0987654321  # Comma-separated list

# Email Alerts (SMTP)
QT_ESS_EMAIL_ENABLED=false                   # Enable email notifications (default: false)
QT_ESS_SMTP_HOST=smtp.gmail.com
QT_ESS_SMTP_PORT=587
QT_ESS_SMTP_USERNAME=your-email@gmail.com
QT_ESS_SMTP_PASSWORD=your-app-specific-password
QT_ESS_EMAIL_FROM=alerts@quantumtrader.com
QT_ESS_EMAIL_TO=admin@quantumtrader.com,trader@quantumtrader.com  # Comma-separated

# === ESS: Monitoring & Logging ===
QT_ESS_LOG_LEVEL=INFO                        # ESS logging level (DEBUG/INFO/WARNING/ERROR)
QT_ESS_ACTIVATION_LOG_PATH=data/ess_activations.log  # Path to activation log file
QT_ESS_ENABLE_METRICS=true                   # Publish ESS metrics to monitoring (default: true)

# === ESS: Testing & Development ===
QT_ESS_DRY_RUN=false                         # Test mode - log actions without executing (default: false)
QT_ESS_SKIP_POSITION_CLOSURE=false           # Skip closing positions (for testing, default: false)
QT_ESS_SKIP_ORDER_CANCELLATION=false         # Skip canceling orders (for testing, default: false)

# === ESS: Integration ===
QT_ESS_USE_POLICY_STORE=true                 # Read thresholds from PolicyStore (default: true)
QT_ESS_USE_EVENT_BUS=true                    # Publish events to EventBus (default: true)
QT_ESS_BLOCK_ORCHESTRATOR=true               # Block Orchestrator when ESS active (default: true)
QT_ESS_BLOCK_RISK_GUARD=true                 # Block RiskGuard approval when ESS active (default: true)

# ============================================================================
# STAGING ENVIRONMENT OVERRIDES
# ============================================================================
# Uncomment these for staging/paper trading deployment:

# QT_ESS_MAX_DAILY_LOSS=5.0                  # More conservative in staging
# QT_ESS_MAX_EQUITY_DD=8.0                   # Tighter drawdown limit
# QT_ESS_DRY_RUN=true                        # Test without real execution
# QT_ESS_SLACK_ENABLED=true                  # Enable alerts in staging
# QT_ESS_EMAIL_ENABLED=true                  # Enable email alerts

# ============================================================================
# PRODUCTION ENVIRONMENT OVERRIDES
# ============================================================================
# Recommended for live trading with real capital:

# QT_ESS_MAX_DAILY_LOSS=10.0                 # Maximum acceptable daily loss
# QT_ESS_MAX_EQUITY_DD=15.0                  # Maximum equity drawdown
# QT_ESS_MAX_SL_HITS=3                       # Stricter execution error limit
# QT_ESS_DRY_RUN=false                       # Full execution in production
# QT_ESS_SLACK_ENABLED=true                  # Critical alerts to Slack
# QT_ESS_SMS_ENABLED=true                    # SMS alerts for emergencies
# QT_ESS_EMAIL_ENABLED=true                  # Email alerts for audit trail

# ============================================================================
# QUARTERLY DRILL SETTINGS
# ============================================================================
# For testing ESS activation manually (use with scripts/ess-drill.ps1):

# QT_ESS_MANUAL_TRIGGER_ENABLED=true         # Allow manual trigger via API
# QT_ESS_DRILL_MODE=true                     # Mark activations as drills
# QT_ESS_DRILL_AUTO_RESET_MINUTES=5          # Auto-reset after X minutes in drill mode

# ============================================================================
# NOTES
# ============================================================================
# 1. ESS requires MANUAL reset - no automatic recovery
# 2. All thresholds are cumulative - any evaluator can trigger ESS
# 3. Slack/SMS/Email alerts require valid credentials
# 4. Test ESS in paper trading BEFORE deploying to production
# 5. Run quarterly drills to verify ESS functionality
# 6. Monitor data/ess_activations.log for activation history
# 7. PolicyStore integration allows dynamic threshold updates
