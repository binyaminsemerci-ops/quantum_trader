{
  "dashboard": {
    "title": "Exit Intelligence",
    "tags": ["exits", "intelligence", "performance"],
    "timezone": "browser",
    "schemaVersion": 38,
    "version": 1,
    "refresh": "30s",
    "panels": [
      {
        "id": 1,
        "type": "stat",
        "title": "Average PnL (All Regimes)",
        "gridPos": {"h": 6, "w": 6, "x": 0, "y": 0},
        "targets": [
          {
            "expr": "avg(quantum_exit_pnl_usdt)",
            "refId": "A"
          }
        ],
        "fieldConfig": {
          "defaults": {
            "unit": "currencyUSD",
            "decimals": 2,
            "thresholds": {
              "mode": "absolute",
              "steps": [
                {"value": null, "color": "red"},
                {"value": 0, "color": "green"}
              ]
            }
          }
        }
      },
      {
        "id": 2,
        "type": "stat",
        "title": "Total Trades Closed",
        "gridPos": {"h": 6, "w": 6, "x": 6, "y": 0},
        "targets": [
          {
            "expr": "sum(quantum_exit_trades_closed_total)",
            "refId": "A"
          }
        ],
        "fieldConfig": {
          "defaults": {
            "unit": "short",
            "decimals": 0,
            "color": {"mode": "thresholds"},
            "thresholds": {
              "mode": "absolute",
              "steps": [
                {"value": null, "color": "blue"}
              ]
            }
          }
        }
      },
      {
        "id": 3,
        "type": "stat",
        "title": "Average Expectancy",
        "gridPos": {"h": 6, "w": 6, "x": 12, "y": 0},
        "targets": [
          {
            "expr": "avg(quantum_exit_expectancy)",
            "refId": "A"
          }
        ],
        "fieldConfig": {
          "defaults": {
            "unit": "currencyUSD",
            "decimals": 2,
            "thresholds": {
              "mode": "absolute",
              "steps": [
                {"value": null, "color": "red"},
                {"value": 0, "color": "yellow"},
                {"value": 10, "color": "green"}
              ]
            }
          }
        }
      },
      {
        "id": 4,
        "type": "stat",
        "title": "Total Exits",
        "gridPos": {"h": 6, "w": 6, "x": 18, "y": 0},
        "targets": [
          {
            "expr": "sum(quantum_exit_exits_total)",
            "refId": "A"
          }
        ],
        "fieldConfig": {
          "defaults": {
            "unit": "short",
            "decimals": 0,
            "color": {"mode": "palette-classic"}
          }
        }
      },
      {
        "id": 5,
        "type": "timeseries",
        "title": "PnL by Symbol (Trend vs Chop)",
        "gridPos": {"h": 8, "w": 12, "x": 0, "y": 6},
        "targets": [
          {
            "expr": "quantum_exit_pnl_usdt{regime=\"trend\"}",
            "legendFormat": "{{symbol}} (Trend)",
            "refId": "A"
          },
          {
            "expr": "quantum_exit_pnl_usdt{regime=\"chop\"}",
            "legendFormat": "{{symbol}} (Chop)",
            "refId": "B"
          }
        ],
        "fieldConfig": {
          "defaults": {
            "unit": "currencyUSD",
            "custom": {
              "drawStyle": "line",
              "lineInterpolation": "smooth",
              "fillOpacity": 10
            }
          }
        }
      },
      {
        "id": 6,
        "type": "timeseries",
        "title": "MFE vs MAE by Regime",
        "gridPos": {"h": 8, "w": 12, "x": 12, "y": 6},
        "targets": [
          {
            "expr": "avg(quantum_exit_mfe_usdt) by (regime)",
            "legendFormat": "MFE ({{regime}})",
            "refId": "A"
          },
          {
            "expr": "avg(quantum_exit_mae_usdt) by (regime)",
            "legendFormat": "MAE ({{regime}})",
            "refId": "B"
          }
        ],
        "fieldConfig": {
          "defaults": {
            "unit": "currencyUSD",
            "custom": {
              "drawStyle": "line",
              "lineInterpolation": "smooth"
            }
          }
        }
      },
      {
        "id": 7,
        "type": "bargauge",
        "title": "Partial Win Rate by Exit Type",
        "gridPos": {"h": 8, "w": 8, "x": 0, "y": 14},
        "targets": [
          {
            "expr": "quantum_exit_partial_winrate",
            "legendFormat": "{{exit_type}} ({{symbol}})",
            "refId": "A"
          }
        ],
        "fieldConfig": {
          "defaults": {
            "unit": "percentunit",
            "min": 0,
            "max": 1,
            "thresholds": {
              "mode": "absolute",
              "steps": [
                {"value": 0, "color": "red"},
                {"value": 0.4, "color": "yellow"},
                {"value": 0.6, "color": "green"}
              ]
            }
          }
        },
        "options": {
          "orientation": "horizontal",
          "displayMode": "gradient"
        }
      },
      {
        "id": 8,
        "type": "bargauge",
        "title": "Exit Efficiency (Exit Price / MFE)",
        "gridPos": {"h": 8, "w": 8, "x": 8, "y": 14},
        "targets": [
          {
            "expr": "quantum_exit_efficiency",
            "legendFormat": "{{exit_type}} ({{symbol}})",
            "refId": "A"
          }
        ],
        "fieldConfig": {
          "defaults": {
            "unit": "percentunit",
            "min": 0,
            "max": 1,
            "thresholds": {
              "mode": "absolute",
              "steps": [
                {"value": 0, "color": "red"},
                {"value": 0.7, "color": "yellow"},
                {"value": 0.9, "color": "green"}
              ]
            }
          }
        },
        "options": {
          "orientation": "horizontal",
          "displayMode": "gradient"
        }
      },
      {
        "id": 9,
        "type": "timeseries",
        "title": "Time in Trade (seconds)",
        "gridPos": {"h": 8, "w": 8, "x": 16, "y": 14},
        "targets": [
          {
            "expr": "quantum_exit_time_seconds",
            "legendFormat": "{{symbol}} ({{regime}})",
            "refId": "A"
          }
        ],
        "fieldConfig": {
          "defaults": {
            "unit": "s",
            "custom": {
              "drawStyle": "bars",
              "fillOpacity": 80
            }
          }
        }
      },
      {
        "id": 10,
        "type": "heatmap",
        "title": "PnL Distribution (Histogram)",
        "gridPos": {"h": 8, "w": 12, "x": 0, "y": 22},
        "targets": [
          {
            "expr": "quantum_exit_pnl_histogram_bucket",
            "format": "heatmap",
            "refId": "A"
          }
        ],
        "fieldConfig": {
          "defaults": {
            "custom": {
              "hideFrom": {
                "tooltip": false,
                "viz": false,
                "legend": false
              }
            }
          }
        },
        "options": {
          "calculate": false,
          "cellGap": 2,
          "color": {
            "mode": "scheme",
            "scheme": "Spectral",
            "steps": 128
          },
          "yAxis": {
            "unit": "currencyUSD"
          }
        }
      },
      {
        "id": 11,
        "type": "table",
        "title": "Expectancy by Symbol & Regime",
        "gridPos": {"h": 8, "w": 12, "x": 12, "y": 22},
        "targets": [
          {
            "expr": "quantum_exit_expectancy",
            "format": "table",
            "instant": true,
            "refId": "A"
          }
        ],
        "fieldConfig": {
          "defaults": {
            "custom": {
              "align": "auto"
            }
          },
          "overrides": [
            {
              "matcher": {"id": "byName", "options": "Value"},
              "properties": [
                {"id": "unit", "value": "currencyUSD"},
                {"id": "decimals", "value": 2},
                {
                  "id": "custom.cellOptions",
                  "value": {
                    "type": "color-background",
                    "mode": "gradient"
                  }
                },
                {
                  "id": "thresholds",
                  "value": {
                    "mode": "absolute",
                    "steps": [
                      {"value": null, "color": "red"},
                      {"value": 0, "color": "yellow"},
                      {"value": 10, "color": "green"}
                    ]
                  }
                }
              ]
            }
          ]
        },
        "transformations": [
          {
            "id": "organize",
            "options": {
              "excludeByName": {
                "__name__": true,
                "Time": true,
                "job": true,
                "instance": true,
                "service": true
              },
              "indexByName": {
                "symbol": 0,
                "regime": 1,
                "Value": 2
              },
              "renameByName": {
                "symbol": "Symbol",
                "regime": "Regime",
                "Value": "Expectancy"
              }
            }
          }
        ]
      },
      {
        "id": 12,
        "type": "piechart",
        "title": "Trades by Regime",
        "gridPos": {"h": 8, "w": 8, "x": 0, "y": 30},
        "targets": [
          {
            "expr": "sum(quantum_exit_trades_closed_total) by (regime)",
            "refId": "A"
          }
        ],
        "options": {
          "legend": {
            "displayMode": "table",
            "placement": "right",
            "values": ["value", "percent"]
          },
          "pieType": "donut",
          "tooltip": {
            "mode": "single"
          }
        },
        "fieldConfig": {
          "defaults": {
            "unit": "short"
          }
        }
      },
      {
        "id": 13,
        "type": "piechart",
        "title": "Exits by Type",
        "gridPos": {"h": 8, "w": 8, "x": 8, "y": 30},
        "targets": [
          {
            "expr": "sum(quantum_exit_exits_total) by (exit_type)",
            "refId": "A"
          }
        ],
        "options": {
          "legend": {
            "displayMode": "table",
            "placement": "right",
            "values": ["value", "percent"]
          },
          "pieType": "pie",
          "tooltip": {
            "mode": "single"
          }
        },
        "fieldConfig": {
          "defaults": {
            "unit": "short"
          }
        }
      },
      {
        "id": 14,
        "type": "stat",
        "title": "Best Performing Symbol",
        "gridPos": {"h": 4, "w": 8, "x": 16, "y": 30},
        "targets": [
          {
            "expr": "topk(1, quantum_exit_pnl_usdt)",
            "refId": "A"
          }
        ],
        "fieldConfig": {
          "defaults": {
            "unit": "currencyUSD",
            "decimals": 2,
            "color": {"mode": "thresholds"},
            "thresholds": {
              "mode": "absolute",
              "steps": [
                {"value": null, "color": "green"}
              ]
            },
            "mappings": []
          }
        },
        "options": {
          "graphMode": "none",
          "textMode": "value_and_name"
        }
      },
      {
        "id": 15,
        "type": "stat",
        "title": "Worst Performing Symbol",
        "gridPos": {"h": 4, "w": 8, "x": 16, "y": 34},
        "targets": [
          {
            "expr": "bottomk(1, quantum_exit_pnl_usdt)",
            "refId": "A"
          }
        ],
        "fieldConfig": {
          "defaults": {
            "unit": "currencyUSD",
            "decimals": 2,
            "color": {"mode": "thresholds"},
            "thresholds": {
              "mode": "absolute",
              "steps": [
                {"value": null, "color": "red"}
              ]
            }
          }
        },
        "options": {
          "graphMode": "none",
          "textMode": "value_and_name"
        }
      }
    ]
  }
}
