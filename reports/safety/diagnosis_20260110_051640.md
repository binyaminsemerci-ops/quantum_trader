# DIAGNOSIS MODE - Telemetry Flow Analysis

**Timestamp:** 2026-01-10 05:16:40 UTC
**Mode:** Telemetry-Only (QSC-Compliant)
**Purpose:** Identify variance collapse root cause

---

## Executive Summary

Analyzed 1983 ensemble decisions from Redis stream.

**Critical Findings:**
- ðŸš¨ xgb: 78.5% HOLD (majority collapse)
- ðŸš¨ lgbm: 75.2% SELL (majority collapse)
- ðŸš¨ nhits: 92.5% SELL (majority collapse)
- ðŸš¨ patchtst: 79.2% HOLD (majority collapse)

---

## 1. Confidence Distribution Analysis

### xgb

**Raw Confidence Stats:**
- Mean: 0.6050
- Std: 0.2009
- Range: [0.5000, 0.9959] (width: 0.4959)
- P10-P90: [0.5000, 0.9931] (gap: 0.4931)

**âœ… Healthy distribution**

### lgbm

**Raw Confidence Stats:**
- Mean: 0.7248
- Std: 0.0637
- Range: [0.5000, 0.7500] (width: 0.2500)
- P10-P90: [0.6333, 0.7500] (gap: 0.1167)

**ðŸ”´ Collapse Indicators:**
- P10-P90 gap 0.1167

### nhits

**Raw Confidence Stats:**
- Mean: 0.5547
- Std: 0.0409
- Range: [0.5167, 0.6500] (width: 0.1333)
- P10-P90: [0.5364, 0.6500] (gap: 0.1136)

**ðŸ”´ Collapse Indicators:**
- Flat distribution (std=0.0409)
- P10-P90 gap 0.1136

### patchtst

**Raw Confidence Stats:**
- Mean: 0.5257
- Std: 0.0505
- Range: [0.5000, 0.6504] (width: 0.1504)
- P10-P90: [0.5000, 0.6150] (gap: 0.1150)

**ðŸ”´ Collapse Indicators:**
- P10-P90 gap 0.1150
- Quantized (5 unique values)

### fallback

**Raw Confidence Stats:**
- Mean: 0.7150
- Std: 0.0132
- Range: [0.6800, 0.7200] (width: 0.0400)
- P10-P90: [0.6800, 0.7200] (gap: 0.0400)

**ðŸ”´ Collapse Indicators:**
- Flat distribution (std=0.0132)
- Narrow range (0.0400)
- P10-P90 gap 0.0400
- Quantized (2 unique values)

---

## 2. Action Mapping Threshold Analysis

### xgb

**Action â†’ Confidence Ranges:**
- **BUY**: 21.5% (237/1104)
  - Confidence: [0.9762, 0.9959]
  - Mean: 0.9893 Â± 0.0059
- **HOLD**: 78.5% (867/1104)
  - Confidence: [0.5000, 0.5000]
  - Mean: 0.5000 Â± 0.0000

**ðŸ”´ DEAD ZONE DETECTED:**
- Range: [0.5000, 0.5000]
- Width: 0.0000
- Trapped samples: 867 (78.5%)


### lgbm

**Action â†’ Confidence Ranges:**
- **BUY**: 19.7% (218/1104)
  - Confidence: [0.5738, 0.7500]
  - Mean: 0.7292 Â± 0.0462
- **SELL**: 75.2% (830/1104)
  - Confidence: [0.5738, 0.7500]
  - Mean: 0.7388 Â± 0.0351
- **HOLD**: 5.1% (56/1104)
  - Confidence: [0.5000, 0.5000]
  - Mean: 0.5000 Â± 0.0000

**ðŸ”´ DEAD ZONE DETECTED:**
- Range: [0.5000, 0.5000]
- Width: 0.0000
- Trapped samples: 56 (5.1%)

**Inferred Thresholds:**
- BUY threshold: â‰¥ 0.5738
- SELL threshold: â‰¤ 0.7500

### nhits

**Action â†’ Confidence Ranges:**
- **BUY**: 7.5% (83/1104)
  - Confidence: [0.5167, 0.6500]
  - Mean: 0.6348 Â± 0.0337
- **SELL**: 92.5% (1021/1104)
  - Confidence: [0.5167, 0.6500]
  - Mean: 0.5482 Â± 0.0339


**Inferred Thresholds:**
- BUY threshold: â‰¥ 0.5167
- SELL threshold: â‰¤ 0.6500

### patchtst

**Action â†’ Confidence Ranges:**
- **BUY**: 20.8% (230/1104)
  - Confidence: [0.6150, 0.6504]
  - Mean: 0.6234 Â± 0.0135
- **HOLD**: 79.2% (874/1104)
  - Confidence: [0.5000, 0.5000]
  - Mean: 0.5000 Â± 0.0000

**ðŸ”´ DEAD ZONE DETECTED:**
- Range: [0.5000, 0.5000]
- Width: 0.0000
- Trapped samples: 874 (79.2%)


### fallback

**Action â†’ Confidence Ranges:**
- **BUY**: 66.9% (588/879)
  - Confidence: [0.6800, 0.7200]
  - Mean: 0.7165 Â± 0.0114
- **SELL**: 33.1% (291/879)
  - Confidence: [0.6800, 0.7200]
  - Mean: 0.7122 Â± 0.0159


**Inferred Thresholds:**
- BUY threshold: â‰¥ 0.6800
- SELL threshold: â‰¤ 0.7200

---

## 3. Ensemble Voting Analysis

**Total Decisions:** 1983

**Final Action Distribution:**
- BUY: 43.0%
- SELL: 57.0%

**Consensus Stats:**
- Mean: 39.18%
- Std: 0.1327

---

## 4. Policy Rules Detection

- Shadow mode: patchtst
- Suspected hardcoded confidence: lgbm = 0.75

---

## 5. ROOT CAUSE ANALYSIS

### Root Cause #1: Dead Zone Trap (xgb)

**Evidence:**  
78.5% samples trapped in HOLD range [0.5000, 0.5000]

**Mechanism:**  
Model outputs confidence in dead zone â†’ mapped to HOLD â†’ no directional signal

### Root Cause #2: Dead Zone Trap (patchtst)

**Evidence:**  
79.2% samples trapped in HOLD range [0.5000, 0.5000]

**Mechanism:**  
Model outputs confidence in dead zone â†’ mapped to HOLD â†’ no directional signal

### Root Cause #3: Narrow Confidence Range (nhits)

**Evidence:**  
Range = 0.1333 (min=0.5167, max=0.6500)

**Mechanism:**  
Model collapsed to constant output â†’ no discrimination between samples

### Root Cause #4: Narrow Confidence Range (fallback)

**Evidence:**  
Range = 0.0400 (min=0.6800, max=0.7200)

**Mechanism:**  
Model collapsed to constant output â†’ no discrimination between samples

### Root Cause #5: Quantized Output (patchtst)

**Evidence:**  
Quantized (5 unique values)

**Mechanism:**  
Model outputs only discrete values â†’ likely fallback rules or hardcoded logic

### Root Cause #6: Quantized Output (fallback)

**Evidence:**  
Quantized (2 unique values)

**Mechanism:**  
Model outputs only discrete values â†’ likely fallback rules or hardcoded logic

---

## 6. CONCRETE FIX OPTIONS

### Fix #1: Adjust Action Mapping Thresholds [HIGH]

**Action:**  
Narrow HOLD dead zone from [0.4, 0.6] to [0.45, 0.55] or remove entirely

**Rationale:**  
Too many samples trapped in HOLD range

**Implementation:**  
Update action mapping logic in model inference code

### Fix #2: Retrain with Anti-Collapse Regularization [CRITICAL]

**Action:**  
Add variance penalty (weight=1.0) + entropy regularization to loss function

**Rationale:**  
Model collapsed to constant output during training

**Implementation:**  
P0.8 retraining with balanced sampling + variance loss

### Fix #3: Remove Fallback Rules [MEDIUM]

**Action:**  
Disable lgbm_fallback_rules or reduce hardcoded confidence values

**Rationale:**  
Fallback logic producing quantized outputs (0.75, 0.68)

**Implementation:**  
Update ensemble voting to exclude fallback models

### Fix #4: Activate Shadow Models (if quality gate passes) [LOW]

**Action:**  
Move patchtst from shadow to active after retraining

**Rationale:**  
Shadow models not contributing to ensemble decisions

**Implementation:**  
Update model config + canary activation

---

## 7. CONTRACT COMPLIANCE CHECK

- **QSC Wrapper:** âœ… PASS - Executed via ops/run.sh ai-engine
- **Telemetry-Only:** âœ… PASS - No model files loaded, Redis stream only
- **Localhost Redis:** âœ… PASS - Connected to localhost:6379
- **FAIL-CLOSED:** âœ… PASS - No activation attempted
- **Audit Trail:** âœ… PASS - Full report generated
- **No Training:** âœ… PASS - Diagnosis mode only
- **No Activation:** âœ… PASS - No model deployment

---

## 8. NEXT STEPS

1. **Review root causes** with dev team
2. **Prioritize fixes** (CRITICAL â†’ HIGH â†’ MEDIUM â†’ LOW)
3. **Implement chosen fix** (do NOT activate before quality gate)
4. **Re-run quality gate:** `make quality-gate` (must exit 0)
5. **IF PASS:** Consider canary activation with `ops/model_safety/canary_activate.sh`
6. **Monitor via scoreboard:** `make scoreboard` (hourly for 6h)

**DO NOT SKIP QUALITY GATE.**

---

**Generated:** 2026-01-10 05:16:40 UTC  
**Mode:** DIAGNOSIS (No Training/Activation)  
**Status:** Analysis Complete