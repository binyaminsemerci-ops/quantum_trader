# DIAGNOSIS MODE - Telemetry Flow Analysis

**Timestamp:** 2026-01-10 05:45:46 UTC
**Mode:** Telemetry-Only (QSC-Compliant)
**Purpose:** Identify variance collapse root cause

---

## Executive Summary

Analyzed 1983 ensemble decisions from Redis stream.

**Critical Findings:**
- ðŸš¨ xgb: 75.9% HOLD (majority collapse)
- ðŸš¨ lgbm: 73.6% SELL (majority collapse)
- ðŸš¨ nhits: 93.0% SELL (majority collapse)
- ðŸš¨ patchtst: 76.5% HOLD (majority collapse)

---

## 1. Confidence Distribution Analysis

### xgb

**Raw Confidence Stats:**
- Mean: 0.6182
- Std: 0.2095
- Range: [0.5000, 0.9959] (width: 0.4959)
- P10-P90: [0.5000, 0.9931] (gap: 0.4931)

**âœ… Healthy distribution**

### lgbm

**Raw Confidence Stats:**
- Mean: 0.7251
- Std: 0.0670
- Range: [0.5000, 1.0500] (width: 0.5500)
- P10-P90: [0.6333, 0.7500] (gap: 0.1167)

**ðŸ”´ Collapse Indicators:**
- P10-P90 gap 0.1167

### nhits

**Raw Confidence Stats:**
- Mean: 0.5544
- Std: 0.0409
- Range: [0.5167, 0.6500] (width: 0.1333)
- P10-P90: [0.5364, 0.6500] (gap: 0.1136)

**ðŸ”´ Collapse Indicators:**
- Flat distribution (std=0.0409)
- P10-P90 gap 0.1136

### patchtst

**Raw Confidence Stats:**
- Mean: 0.5288
- Std: 0.0523
- Range: [0.5000, 0.6504] (width: 0.1504)
- P10-P90: [0.5000, 0.6150] (gap: 0.1150)

**ðŸ”´ Collapse Indicators:**
- P10-P90 gap 0.1150
- Quantized (5 unique values)

### fallback

**Raw Confidence Stats:**
- Mean: 0.7150
- Std: 0.0132
- Range: [0.6800, 0.7200] (width: 0.0400)
- P10-P90: [0.6800, 0.7200] (gap: 0.0400)

**ðŸ”´ Collapse Indicators:**
- Flat distribution (std=0.0132)
- Narrow range (0.0400)
- P10-P90 gap 0.0400
- Quantized (2 unique values)

---

## 2. Action Mapping Threshold Analysis

### xgb

**Action â†’ Confidence Ranges:**
- **BUY**: 24.1% (268/1110)
  - Confidence: [0.9762, 0.9959]
  - Mean: 0.9894 Â± 0.0059
- **HOLD**: 75.9% (842/1110)
  - Confidence: [0.5000, 0.5000]
  - Mean: 0.5000 Â± 0.0000

**ðŸ”´ DEAD ZONE DETECTED:**
- Range: [0.5000, 0.5000]
- Width: 0.0000
- Trapped samples: 842 (75.9%)


### lgbm

**Action â†’ Confidence Ranges:**
- **BUY**: 21.0% (233/1110)
  - Confidence: [0.5738, 0.7500]
  - Mean: 0.7316 Â± 0.0437
- **SELL**: 73.6% (817/1110)
  - Confidence: [0.5738, 1.0500]
  - Mean: 0.7397 Â± 0.0400
- **HOLD**: 5.4% (60/1110)
  - Confidence: [0.5000, 0.5000]
  - Mean: 0.5000 Â± 0.0000

**ðŸ”´ DEAD ZONE DETECTED:**
- Range: [0.5000, 0.5000]
- Width: 0.0000
- Trapped samples: 60 (5.4%)

**Inferred Thresholds:**
- BUY threshold: â‰¥ 0.5738
- SELL threshold: â‰¤ 1.0500

### nhits

**Action â†’ Confidence Ranges:**
- **BUY**: 7.0% (78/1110)
  - Confidence: [0.5167, 0.6500]
  - Mean: 0.6361 Â± 0.0354
- **SELL**: 93.0% (1032/1110)
  - Confidence: [0.5167, 0.6500]
  - Mean: 0.5483 Â± 0.0341


**Inferred Thresholds:**
- BUY threshold: â‰¥ 0.5167
- SELL threshold: â‰¤ 0.6500

### patchtst

**Action â†’ Confidence Ranges:**
- **BUY**: 23.5% (261/1110)
  - Confidence: [0.6150, 0.6504]
  - Mean: 0.6224 Â± 0.0130
- **HOLD**: 76.5% (849/1110)
  - Confidence: [0.5000, 0.5000]
  - Mean: 0.5000 Â± 0.0000

**ðŸ”´ DEAD ZONE DETECTED:**
- Range: [0.5000, 0.5000]
- Width: 0.0000
- Trapped samples: 849 (76.5%)


### fallback

**Action â†’ Confidence Ranges:**
- **BUY**: 67.0% (585/873)
  - Confidence: [0.6800, 0.7200]
  - Mean: 0.7164 Â± 0.0114
- **SELL**: 33.0% (288/873)
  - Confidence: [0.6800, 0.7200]
  - Mean: 0.7121 Â± 0.0159


**Inferred Thresholds:**
- BUY threshold: â‰¥ 0.6800
- SELL threshold: â‰¤ 0.7200

---

## 3. Ensemble Voting Analysis

**Total Decisions:** 1983

**Final Action Distribution:**
- SELL: 56.2%
- BUY: 43.8%

**Consensus Stats:**
- Mean: 39.26%
- Std: 0.1326

---

## 4. Policy Rules Detection

- Suspected hardcoded confidence: lgbm = 0.5
- Shadow mode: patchtst
- Suspected hardcoded confidence: lgbm = 0.75

---

## 5. ROOT CAUSE ANALYSIS

### Root Cause #1: Dead Zone Trap (xgb)

**Evidence:**  
75.9% samples trapped in HOLD range [0.5000, 0.5000]

**Mechanism:**  
Model outputs confidence in dead zone â†’ mapped to HOLD â†’ no directional signal

### Root Cause #2: Dead Zone Trap (patchtst)

**Evidence:**  
76.5% samples trapped in HOLD range [0.5000, 0.5000]

**Mechanism:**  
Model outputs confidence in dead zone â†’ mapped to HOLD â†’ no directional signal

### Root Cause #3: Narrow Confidence Range (nhits)

**Evidence:**  
Range = 0.1333 (min=0.5167, max=0.6500)

**Mechanism:**  
Model collapsed to constant output â†’ no discrimination between samples

### Root Cause #4: Narrow Confidence Range (fallback)

**Evidence:**  
Range = 0.0400 (min=0.6800, max=0.7200)

**Mechanism:**  
Model collapsed to constant output â†’ no discrimination between samples

### Root Cause #5: Quantized Output (patchtst)

**Evidence:**  
Quantized (5 unique values)

**Mechanism:**  
Model outputs only discrete values â†’ likely fallback rules or hardcoded logic

### Root Cause #6: Quantized Output (fallback)

**Evidence:**  
Quantized (2 unique values)

**Mechanism:**  
Model outputs only discrete values â†’ likely fallback rules or hardcoded logic

---

## 6. CONCRETE FIX OPTIONS

### Fix #1: Adjust Action Mapping Thresholds [HIGH]

**Action:**  
Narrow HOLD dead zone from [0.4, 0.6] to [0.45, 0.55] or remove entirely

**Rationale:**  
Too many samples trapped in HOLD range

**Implementation:**  
Update action mapping logic in model inference code

### Fix #2: Retrain with Anti-Collapse Regularization [CRITICAL]

**Action:**  
Add variance penalty (weight=1.0) + entropy regularization to loss function

**Rationale:**  
Model collapsed to constant output during training

**Implementation:**  
P0.8 retraining with balanced sampling + variance loss

### Fix #3: Remove Fallback Rules [MEDIUM]

**Action:**  
Disable lgbm_fallback_rules or reduce hardcoded confidence values

**Rationale:**  
Fallback logic producing quantized outputs (0.75, 0.68)

**Implementation:**  
Update ensemble voting to exclude fallback models

### Fix #4: Activate Shadow Models (if quality gate passes) [LOW]

**Action:**  
Move patchtst from shadow to active after retraining

**Rationale:**  
Shadow models not contributing to ensemble decisions

**Implementation:**  
Update model config + canary activation

---

## 7. CONTRACT COMPLIANCE CHECK

- **QSC Wrapper:** âœ… PASS - Executed via ops/run.sh ai-engine
- **Telemetry-Only:** âœ… PASS - No model files loaded, Redis stream only
- **Localhost Redis:** âœ… PASS - Connected to localhost:6379
- **FAIL-CLOSED:** âœ… PASS - No activation attempted
- **Audit Trail:** âœ… PASS - Full report generated
- **No Training:** âœ… PASS - Diagnosis mode only
- **No Activation:** âœ… PASS - No model deployment

---

## 8. NEXT STEPS

1. **Review root causes** with dev team
2. **Prioritize fixes** (CRITICAL â†’ HIGH â†’ MEDIUM â†’ LOW)
3. **Implement chosen fix** (do NOT activate before quality gate)
4. **Re-run quality gate:** `make quality-gate` (must exit 0)
5. **IF PASS:** Consider canary activation with `ops/model_safety/canary_activate.sh`
6. **Monitor via scoreboard:** `make scoreboard` (hourly for 6h)

**DO NOT SKIP QUALITY GATE.**

---

**Generated:** 2026-01-10 05:45:46 UTC  
**Mode:** DIAGNOSIS (No Training/Activation)  
**Status:** Analysis Complete