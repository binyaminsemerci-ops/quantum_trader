# DIAGNOSIS MODE - Telemetry Flow Analysis

**Timestamp:** 2026-01-10 21:46:40 UTC
**Mode:** Telemetry-Only (QSC-Compliant)
**Purpose:** Identify variance collapse root cause

---

## Executive Summary

Analyzed 1418 ensemble decisions from Redis stream.

**Critical Findings:**
- ðŸš¨ xgb: 100.0% BUY (majority collapse)
- ðŸš¨ nhits: 99.6% SELL (majority collapse)
- ðŸš¨ patchtst: 100.0% BUY (majority collapse)

---

## 1. Confidence Distribution Analysis

### xgb

**Raw Confidence Stats:**
- Mean: 0.9855
- Std: 0.0069
- Range: [0.9750, 0.9959] (width: 0.0209)
- P10-P90: [0.9772, 0.9934] (gap: 0.0162)

**ðŸ”´ Collapse Indicators:**
- Flat distribution (std=0.0069)
- Narrow range (0.0209)
- P10-P90 gap 0.0162

### lgbm

**Raw Confidence Stats:**
- Mean: 0.9653
- Std: 0.1577
- Range: [0.5000, 1.0500] (width: 0.5500)
- P10-P90: [0.6333, 1.0500] (gap: 0.4167)

**âœ… Healthy distribution**

### nhits

**Raw Confidence Stats:**
- Mean: 0.5370
- Std: 0.0086
- Range: [0.5167, 0.6500] (width: 0.1333)
- P10-P90: [0.5364, 0.5364] (gap: 0.0000)

**ðŸ”´ Collapse Indicators:**
- Flat distribution (std=0.0086)
- P10-P90 gap 0.0000

### patchtst

**Raw Confidence Stats:**
- Mean: 0.6150
- Std: 0.0000
- Range: [0.6150, 0.6150] (width: 0.0000)
- P10-P90: [0.6150, 0.6150] (gap: 0.0000)

**ðŸ”´ Collapse Indicators:**
- Flat distribution (std=0.0000)
- Narrow range (0.0000)
- P10-P90 gap 0.0000
- Quantized (1 unique values)

---

## 2. Action Mapping Threshold Analysis

### xgb

**Action â†’ Confidence Ranges:**
- **BUY**: 100.0% (1418/1418)
  - Confidence: [0.9750, 0.9959]
  - Mean: 0.9855 Â± 0.0069



### lgbm

**Action â†’ Confidence Ranges:**
- **BUY**: 49.5% (702/1418)
  - Confidence: [0.5500, 1.0500]
  - Mean: 0.9133 Â± 0.1911
- **SELL**: 50.1% (710/1418)
  - Confidence: [0.7722, 1.0500]
  - Mean: 1.0207 Â± 0.0775
- **HOLD**: 0.4% (6/1418)
  - Confidence: [0.5000, 0.5000]
  - Mean: 0.5000 Â± 0.0000

**ðŸ”´ DEAD ZONE DETECTED:**
- Range: [0.5000, 0.5000]
- Width: 0.0000
- Trapped samples: 6 (0.4%)

**Inferred Thresholds:**
- BUY threshold: â‰¥ 0.5500
- SELL threshold: â‰¤ 1.0500

### nhits

**Action â†’ Confidence Ranges:**
- **BUY**: 0.4% (6/1418)
  - Confidence: [0.5167, 0.6500]
  - Mean: 0.6135 Â± 0.0534
- **SELL**: 99.6% (1412/1418)
  - Confidence: [0.5364, 0.6500]
  - Mean: 0.5367 Â± 0.0060


**Inferred Thresholds:**
- BUY threshold: â‰¥ 0.5167
- SELL threshold: â‰¤ 0.6500

### patchtst

**Action â†’ Confidence Ranges:**
- **BUY**: 100.0% (1418/1418)
  - Confidence: [0.6150, 0.6150]
  - Mean: 0.6150 Â± 0.0000



---

## 3. Ensemble Voting Analysis

**Total Decisions:** 1418

**Final Action Distribution:**
- BUY: 49.7%
- SELL: 50.3%

**Consensus Stats:**
- Mean: 50.00%
- Std: 0.0163

---

## 4. Policy Rules Detection

- Shadow mode: patchtst

---

## 5. ROOT CAUSE ANALYSIS

### Root Cause #1: Narrow Confidence Range (xgb)

**Evidence:**  
Range = 0.0209 (min=0.9750, max=0.9959)

**Mechanism:**  
Model collapsed to constant output â†’ no discrimination between samples

### Root Cause #2: Narrow Confidence Range (nhits)

**Evidence:**  
Range = 0.1333 (min=0.5167, max=0.6500)

**Mechanism:**  
Model collapsed to constant output â†’ no discrimination between samples

### Root Cause #3: Narrow Confidence Range (patchtst)

**Evidence:**  
Range = 0.0000 (min=0.6150, max=0.6150)

**Mechanism:**  
Model collapsed to constant output â†’ no discrimination between samples

### Root Cause #4: Quantized Output (patchtst)

**Evidence:**  
Quantized (1 unique values)

**Mechanism:**  
Model outputs only discrete values â†’ likely fallback rules or hardcoded logic

---

## 6. CONCRETE FIX OPTIONS

### Fix #1: Retrain with Anti-Collapse Regularization [CRITICAL]

**Action:**  
Add variance penalty (weight=1.0) + entropy regularization to loss function

**Rationale:**  
Model collapsed to constant output during training

**Implementation:**  
P0.8 retraining with balanced sampling + variance loss

### Fix #2: Remove Fallback Rules [MEDIUM]

**Action:**  
Disable lgbm_fallback_rules or reduce hardcoded confidence values

**Rationale:**  
Fallback logic producing quantized outputs (0.75, 0.68)

**Implementation:**  
Update ensemble voting to exclude fallback models

### Fix #3: Activate Shadow Models (if quality gate passes) [LOW]

**Action:**  
Move patchtst from shadow to active after retraining

**Rationale:**  
Shadow models not contributing to ensemble decisions

**Implementation:**  
Update model config + canary activation

---

## 7. CONTRACT COMPLIANCE CHECK

- **QSC Wrapper:** âœ… PASS - Executed via ops/run.sh ai-engine
- **Telemetry-Only:** âœ… PASS - No model files loaded, Redis stream only
- **Localhost Redis:** âœ… PASS - Connected to localhost:6379
- **FAIL-CLOSED:** âœ… PASS - No activation attempted
- **Audit Trail:** âœ… PASS - Full report generated
- **No Training:** âœ… PASS - Diagnosis mode only
- **No Activation:** âœ… PASS - No model deployment

---

## 8. NEXT STEPS

1. **Review root causes** with dev team
2. **Prioritize fixes** (CRITICAL â†’ HIGH â†’ MEDIUM â†’ LOW)
3. **Implement chosen fix** (do NOT activate before quality gate)
4. **Re-run quality gate:** `make quality-gate` (must exit 0)
5. **IF PASS:** Consider canary activation with `ops/model_safety/canary_activate.sh`
6. **Monitor via scoreboard:** `make scoreboard` (hourly for 6h)

**DO NOT SKIP QUALITY GATE.**

---

**Generated:** 2026-01-10 21:46:40 UTC  
**Mode:** DIAGNOSIS (No Training/Activation)  
**Status:** Analysis Complete